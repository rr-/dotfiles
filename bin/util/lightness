#!/bin/bash
# Switches between dark and light theme in various programs
# (doesn't work too well with SSH)

word=$1
DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

if [[ $word != light && $word != dark ]]; then
    echo "Usage: $0 light|dark"
    exit 1
fi

# MinTTY
if [ -h ~/.minttyrc ]; then
    rm ~/.minttyrc
    ln -s ~/.minttyrc-$word ~/.minttyrc
fi

# wallpaper
if command -v feh &>/dev/null; then
    cli='feh '
    monitor_count=$(xrandr -q|grep ' connected'|wc -l)
    for i in `seq 1 $monitor_count`; do
        cli="$cli --bg-fill ~/.wallpaper-$word-$i"
    done
    eval "$cli"
fi

# bspwm decoration
if command -v bspc &>/dev/null; then
    if [[ $word == light ]]; then
        bspc config normal_border_color "#bbbbbb"
        bspc config active_border_color "#bbbbbb"
        bspc config focused_border_color "#00d0ee"
    else
        bspc config normal_border_color "#555555"
        bspc config active_border_color "#555555"
        bspc config focused_border_color "#00a0a0"
    fi
fi

# zsh
echo -e 'export LIGHTNESS='$word >~/.config/zsh/lightness.sh
echo -e 'export FZF_DEFAULT_OPTS="$FZF_DEFAULT_OPTS --color='$word'"' >>~/.config/zsh/lightness.sh

# vifm
[ -h ~/.config/vifm/colors/current ] && rm ~/.config/vifm/colors/current
ln -s ~/.config/vifm/colors/"$word".vifm ~/.config/vifm/colors/current

# URxvt and xterm
if command -v xrdb &>/dev/null; then
    if [ -h ~/.config/Xresources-theme ]; then
        rm ~/.config/Xresources-theme
    fi
    ln -s ~/.config/Xresources-$word ~/.config/Xresources-theme
    xrdb -override ~/.config/Xresources-theme 2>/dev/null
fi
