#!/usr/bin/env python3
import json
import typing as T
import urllib.request

import click


def lookup_word(word: str) -> T.Dict[str, T.Any]:
    url = "http://jisho.org/api/v1/search/words?keyword=%s" % (
        urllib.parse.quote(word)
    )
    with urllib.request.urlopen(url) as handle:
        return json.loads(handle.read().decode())


def print_definition(definition: T.Dict[str, T.Any]) -> None:
    if not definition["data"]:
        print("Nothing found")
        return
    for entry in definition["data"]:
        print("Definition:")
        for item in entry["japanese"]:
            if "word" in item:
                print("%s (%s)" % (item["word"], item.get("reading", "")))
            else:
                print(item["reading"])
        print("Meanings:")
        for item in entry["senses"]:
            if "english_definitions" in item:
                for definition in item["english_definitions"]:
                    print(definition)
        print("-" * 50)
        print()


@click.command()
@click.argument("words", nargs=-1)
def cli(words: T.List[str]) -> None:
    """Look up word definitions on jisho.org."""
    for word in words:
        definition = lookup_word(word)
        print_definition(definition)


if __name__ == "__main__":
    cli()
